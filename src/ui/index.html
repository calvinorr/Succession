<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Succession | Interviews</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand': {
                            50: '#eef4ff', 100: '#d9e5ff', 200: '#bcd2ff', 300: '#8eb5ff',
                            400: '#598eff', 500: '#3366ff', 600: '#1a44f5', 700: '#1333e1',
                            800: '#162bb6', 900: '#182a8f',
                        },
                        'surface': {
                            0: '#ffffff', 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0',
                            300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569',
                            700: '#334155', 800: '#1e293b', 900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        'display': ['"DM Serif Display"', 'serif'],
                        'body': ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 40px -10px rgba(51, 102, 255, 0.3)',
                        'card': '0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.04)',
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>

<body class="bg-surface-50 font-body text-surface-800 h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-surface-0 border-r border-surface-200/80 flex flex-col h-full flex-shrink-0">
        <div class="flex flex-col h-full p-5">
            <!-- Logo -->
            <div class="flex items-center gap-3 mb-10 px-1">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-500 to-brand-600 flex items-center justify-center shadow-glow">
                    <span class="material-symbols-outlined text-white text-xl">hub</span>
                </div>
                <div>
                    <h1 class="font-display text-xl text-surface-900 tracking-tight">Succession</h1>
                    <p class="text-[10px] uppercase tracking-[0.2em] text-surface-400 font-medium">Expert Systems</p>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex flex-col gap-1 flex-1">
                <a href="dashboard.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">space_dashboard</span>
                    <span class="text-sm font-medium">Dashboard</span>
                </a>
                <a href="index.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl bg-brand-50 text-brand-600 transition-all">
                    <span class="material-symbols-outlined filled text-[20px]">mic</span>
                    <span class="text-sm font-semibold">Interviews</span>
                </a>
                <a href="personas.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">person_search</span>
                    <span class="text-sm font-medium">Personas</span>
                </a>
                <a href="knowledge-base.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">menu_book</span>
                    <span class="text-sm font-medium">Knowledge Base</span>
                </a>
                <div class="flex-1"></div>
                <a href="#" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">settings</span>
                    <span class="text-sm font-medium">Settings</span>
                </a>
            </nav>

            <!-- User -->
            <div class="border-t border-surface-200/80 pt-5 mt-4">
                <div class="flex items-center gap-3 px-1">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-brand-400 to-brand-600 flex items-center justify-center text-white font-semibold text-sm">CU</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold text-surface-800 truncate">Calvin User</p>
                        <p class="text-xs text-surface-400 truncate">admin@succession.io</p>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden">

        <!-- Start Section (shown when no interview active) -->
        <div id="start-section" class="flex-1 flex items-center justify-center p-8">
            <div class="w-full max-w-md">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-brand-500 to-brand-600 flex items-center justify-center shadow-glow">
                        <span class="material-symbols-outlined text-white text-3xl">mic</span>
                    </div>
                    <h1 class="font-display text-3xl text-surface-900 mb-2">Start Interview</h1>
                    <p class="text-surface-500">Select an expert role to begin capturing knowledge</p>
                </div>

                <div class="bg-surface-0 rounded-2xl border border-surface-200/60 shadow-card p-6">
                    <label class="block text-sm font-semibold text-surface-700 mb-2">Expert Role</label>
                    <select id="role-select" class="w-full h-12 px-4 rounded-xl bg-surface-100 border-0 text-surface-700 font-medium focus:outline-none focus:ring-2 focus:ring-brand-500/20 cursor-pointer mb-4">
                        <option value="">Select an expert role...</option>
                        <option value="Finance Director">Finance Director</option>
                        <option value="Head of AP">Head of AP</option>
                        <option value="Head of AR">Head of AR</option>
                        <option value="Head of Treasury">Head of Treasury</option>
                    </select>

                    <button id="start-button" class="w-full h-12 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-xl font-semibold shadow-lg shadow-brand-500/25 hover:shadow-brand-500/40 transition-all flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-[20px]">play_arrow</span>
                        Start Interview
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Section (shown when interview active) -->
        <div id="chat-section" class="flex-1 flex flex-col h-full hidden">

            <!-- Chat Header -->
            <header class="px-6 py-4 bg-surface-0 border-b border-surface-200/60 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center">
                        <span class="material-symbols-outlined text-white">person</span>
                    </div>
                    <div>
                        <h2 class="font-semibold text-surface-800">Interview: <span id="role-display" class="text-brand-600"></span></h2>
                        <p id="phase-display" class="text-xs text-surface-400 uppercase tracking-wider">Phase: Warm-up</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="createSnapshot()" class="flex items-center gap-2 px-4 py-2 rounded-lg border border-surface-200 text-surface-600 hover:bg-surface-50 hover:border-brand-300 hover:text-brand-600 transition-all text-sm font-medium">
                        <span class="material-symbols-outlined text-[18px]">photo_camera</span>
                        Snapshot
                    </button>
                    <button onclick="buildPersona()" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 text-white transition-colors text-sm font-semibold">
                        <span class="material-symbols-outlined text-[18px]">auto_awesome</span>
                        Build Persona
                    </button>
                </div>
            </header>

            <!-- Chat Messages -->
            <div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-4">
                <!-- Messages populated here -->
            </div>

            <!-- Chat Input -->
            <div class="p-4 bg-surface-0 border-t border-surface-200/60">
                <div class="max-w-4xl mx-auto flex gap-3">
                    <input type="text" id="message-input" placeholder="Type your response as the expert..." class="flex-1 h-12 px-5 rounded-xl bg-surface-100 border-0 text-surface-700 placeholder:text-surface-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:bg-surface-0 transition-all">
                    <button id="send-button" class="h-12 px-6 bg-gradient-to-r from-brand-500 to-brand-600 hover:from-brand-600 hover:to-brand-700 text-white rounded-xl font-semibold shadow-lg shadow-brand-500/25 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="material-symbols-outlined text-[18px]">send</span>
                        Send
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script src="ui.js"></script>
    <script>
        // Additional functions for new features
        async function createSnapshot() {
            if (!interviewId) return;

            try {
                const res = await fetch(`/interviews/${interviewId}/note-snapshot`, { method: 'POST' });
                const snapshot = await res.json();
                addMessage('System', `Snapshot created! Captured ${snapshot.topicsCovered?.length || 0} topics and ${snapshot.keyInsights?.length || 0} key insights.`);
            } catch (error) {
                addMessage('System', 'Error creating snapshot. Please try again.');
            }
        }

        async function buildPersona() {
            if (!interviewId) return;

            addMessage('System', 'Building persona from interview insights...');

            try {
                const res = await fetch('/personas/build', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ interviewId })
                });
                const persona = await res.json();
                addMessage('System', `Persona created successfully! ID: ${persona.id}. View it in the Personas section.`);
            } catch (error) {
                addMessage('System', 'Error building persona. Please try again.');
            }
        }
    </script>
</body>
</html>
