<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Succession | My Topics - Expert Portal</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand': {
                            50: '#eef4ff', 100: '#d9e5ff', 200: '#bcd2ff', 300: '#8eb5ff',
                            400: '#598eff', 500: '#3366ff', 600: '#1a44f5', 700: '#1333e1',
                            800: '#162bb6', 900: '#182a8f',
                        },
                        'surface': {
                            0: '#ffffff', 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0',
                            300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569',
                            700: '#334155', 800: '#1e293b', 900: '#0f172a',
                        },
                        'expert': {
                            50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac',
                            400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d',
                        }
                    },
                    fontFamily: {
                        'display': ['"DM Serif Display"', 'serif'],
                        'body': ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 40px -10px rgba(51, 102, 255, 0.3)',
                        'card': '0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.04)',
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>

<body class="bg-surface-50 font-body text-surface-800 h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-surface-0 border-r border-surface-200/80 flex flex-col h-full flex-shrink-0">
        <div class="flex flex-col h-full p-5">
            <!-- Logo -->
            <div class="flex items-center gap-3 mb-10 px-1">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-expert-500 to-expert-600 flex items-center justify-center shadow-glow">
                    <span class="material-symbols-outlined text-white text-xl">school</span>
                </div>
                <div>
                    <h1 class="font-display text-xl text-surface-900 tracking-tight">Succession</h1>
                    <p class="text-[10px] uppercase tracking-[0.2em] text-expert-600 font-medium">Expert Portal</p>
                </div>
            </div>

            <!-- Navigation - Expert Portal -->
            <nav class="flex flex-col gap-1 flex-1">
                <a href="index.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl bg-expert-50 text-expert-600 transition-all">
                    <span class="material-symbols-outlined filled text-[20px]">checklist</span>
                    <span class="text-sm font-semibold">My Topics</span>
                </a>
                <a href="interview.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">mic</span>
                    <span class="text-sm font-medium">Interviews</span>
                </a>
                <a href="review.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">fact_check</span>
                    <span class="text-sm font-medium">Review Knowledge</span>
                </a>
                <div class="flex-1"></div>
                <a href="../index.html" class="flex items-center gap-3 px-3 py-2.5 rounded-xl text-surface-500 hover:text-surface-700 hover:bg-surface-100 transition-all">
                    <span class="material-symbols-outlined text-[20px]">swap_horiz</span>
                    <span class="text-sm font-medium">Switch Role</span>
                </a>
            </nav>

            <!-- User -->
            <div class="border-t border-surface-200/80 pt-5 mt-4">
                <div class="flex items-center gap-3 px-1">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-expert-400 to-expert-600 flex items-center justify-center text-white font-semibold text-sm">EX</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold text-surface-800 truncate">Expert User</p>
                        <p class="text-xs text-surface-400 truncate">Sharing Knowledge</p>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden">
        <!-- Header -->
        <header class="px-8 py-6 bg-surface-0 border-b border-surface-200/60">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="font-display text-2xl text-surface-900">My Topics</h1>
                    <p class="text-sm text-surface-500 mt-1">Define and organize the knowledge areas you want to capture</p>
                </div>
                <button onclick="openAddTopicModal()" class="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-expert-500 to-expert-600 hover:from-expert-600 hover:to-expert-700 text-white rounded-xl font-semibold shadow-lg shadow-expert-500/25 transition-all">
                    <span class="material-symbols-outlined text-[20px]">add</span>
                    Add Topic
                </button>
            </div>

            <!-- Stats Row -->
            <div class="flex gap-6 mt-6">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-surface-100 flex items-center justify-center">
                        <span class="material-symbols-outlined text-surface-500 text-[18px]">folder</span>
                    </div>
                    <div>
                        <p id="stat-total" class="text-lg font-bold text-surface-800">0</p>
                        <p class="text-xs text-surface-400">Total Topics</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center">
                        <span class="material-symbols-outlined text-amber-600 text-[18px]">pending</span>
                    </div>
                    <div>
                        <p id="stat-pending" class="text-lg font-bold text-amber-600">0</p>
                        <p class="text-xs text-surface-400">Pending</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-brand-100 flex items-center justify-center">
                        <span class="material-symbols-outlined text-brand-600 text-[18px]">hourglass_top</span>
                    </div>
                    <div>
                        <p id="stat-inprogress" class="text-lg font-bold text-brand-600">0</p>
                        <p class="text-xs text-surface-400">In Progress</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-expert-100 flex items-center justify-center">
                        <span class="material-symbols-outlined text-expert-600 text-[18px]">check_circle</span>
                    </div>
                    <div>
                        <p id="stat-complete" class="text-lg font-bold text-expert-600">0</p>
                        <p class="text-xs text-surface-400">Complete</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Filter Bar -->
        <div class="px-8 py-4 bg-surface-50 border-b border-surface-200/40 flex items-center gap-4">
            <div class="flex items-center gap-2">
                <span class="text-sm text-surface-500">Filter:</span>
                <select id="filter-status" onchange="applyFilters()" class="h-9 px-3 rounded-lg bg-surface-0 border border-surface-200 text-sm text-surface-700 focus:outline-none focus:ring-2 focus:ring-expert-500/20">
                    <option value="">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="in-progress">In Progress</option>
                    <option value="complete">Complete</option>
                </select>
                <select id="filter-frequency" onchange="applyFilters()" class="h-9 px-3 rounded-lg bg-surface-0 border border-surface-200 text-sm text-surface-700 focus:outline-none focus:ring-2 focus:ring-expert-500/20">
                    <option value="">All Frequencies</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                    <option value="annual">Annual</option>
                    <option value="ad-hoc">Ad-hoc</option>
                </select>
            </div>
            <div class="flex-1"></div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-surface-500">Group by:</span>
                <select id="group-by" onchange="applyFilters()" class="h-9 px-3 rounded-lg bg-surface-0 border border-surface-200 text-sm text-surface-700 focus:outline-none focus:ring-2 focus:ring-expert-500/20">
                    <option value="none">None</option>
                    <option value="frequency">Frequency</option>
                    <option value="status">Status</option>
                    <option value="category">Category</option>
                </select>
            </div>
        </div>

        <!-- Topics List -->
        <div id="topics-container" class="flex-1 overflow-y-auto p-8">
            <div id="topics-loading" class="text-center py-12">
                <span class="material-symbols-outlined text-4xl text-surface-300 animate-spin">progress_activity</span>
                <p class="text-sm text-surface-400 mt-2">Loading topics...</p>
            </div>
            <div id="topics-empty" class="hidden text-center py-12">
                <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-surface-100 flex items-center justify-center">
                    <span class="material-symbols-outlined text-surface-300 text-4xl">folder_open</span>
                </div>
                <h3 class="font-semibold text-surface-700 mb-2">No topics yet</h3>
                <p class="text-sm text-surface-400 mb-4">Start by adding the key topics of your role</p>
                <button onclick="openAddTopicModal()" class="inline-flex items-center gap-2 px-4 py-2.5 bg-expert-500 hover:bg-expert-600 text-white rounded-xl font-semibold transition-all">
                    <span class="material-symbols-outlined text-[20px]">add</span>
                    Add Your First Topic
                </button>
            </div>
            <div id="topics-list" class="hidden space-y-6">
                <!-- Topics will be rendered here -->
            </div>
        </div>
    </main>

    <!-- Add/Edit Topic Modal -->
    <div id="topic-modal" class="fixed inset-0 bg-surface-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-surface-0 rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden">
            <div class="px-6 py-4 border-b border-surface-200 bg-gradient-to-r from-expert-50 to-surface-50">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-expert-400 to-expert-600 flex items-center justify-center">
                            <span id="modal-icon" class="material-symbols-outlined text-white">add_circle</span>
                        </div>
                        <div>
                            <h2 id="modal-title" class="font-display text-xl text-surface-900">Add Topic</h2>
                            <p id="modal-subtitle" class="text-sm text-surface-500">Define a new knowledge area</p>
                        </div>
                    </div>
                    <button onclick="closeTopicModal()" class="p-2 hover:bg-surface-100 rounded-lg transition-colors">
                        <span class="material-symbols-outlined text-surface-400">close</span>
                    </button>
                </div>
            </div>
            <form id="topic-form" onsubmit="saveTopic(event)" class="p-6 space-y-4">
                <input type="hidden" id="topic-id">
                <div>
                    <label class="block text-sm font-semibold text-surface-700 mb-2">Topic Name *</label>
                    <input type="text" id="topic-name" required placeholder="e.g., Daily Cash Flow Management" class="w-full h-11 px-4 rounded-lg bg-surface-100 border-0 text-surface-700 placeholder:text-surface-400 focus:outline-none focus:ring-2 focus:ring-expert-500/20">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-surface-700 mb-2">Description</label>
                    <textarea id="topic-description" rows="3" placeholder="Brief description of what this topic covers..." class="w-full px-4 py-3 rounded-lg bg-surface-100 border-0 text-surface-700 placeholder:text-surface-400 focus:outline-none focus:ring-2 focus:ring-expert-500/20 resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-surface-700 mb-2">Frequency</label>
                        <select id="topic-frequency" class="w-full h-11 px-4 rounded-lg bg-surface-100 border-0 text-surface-700 focus:outline-none focus:ring-2 focus:ring-expert-500/20">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="annual">Annual</option>
                            <option value="ad-hoc" selected>Ad-hoc</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-surface-700 mb-2">Category</label>
                        <input type="text" id="topic-category" placeholder="e.g., Treasury" class="w-full h-11 px-4 rounded-lg bg-surface-100 border-0 text-surface-700 placeholder:text-surface-400 focus:outline-none focus:ring-2 focus:ring-expert-500/20">
                    </div>
                </div>
                <div class="pt-4 flex gap-3">
                    <button type="button" onclick="closeTopicModal()" class="flex-1 px-4 py-2.5 rounded-xl border border-surface-200 text-surface-600 hover:bg-surface-100 transition-all font-medium">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 px-4 py-2.5 rounded-xl bg-expert-500 hover:bg-expert-600 text-white transition-all font-semibold">
                        Save Topic
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // State
        let allTopics = [];
        let filteredTopics = [];

        // Frequency labels and colors
        const FREQUENCY_CONFIG = {
            daily: { label: 'Daily', color: 'bg-red-100 text-red-600', icon: 'today' },
            weekly: { label: 'Weekly', color: 'bg-orange-100 text-orange-600', icon: 'date_range' },
            monthly: { label: 'Monthly', color: 'bg-amber-100 text-amber-600', icon: 'calendar_month' },
            quarterly: { label: 'Quarterly', color: 'bg-blue-100 text-blue-600', icon: 'calendar_view_month' },
            annual: { label: 'Annual', color: 'bg-purple-100 text-purple-600', icon: 'event' },
            'ad-hoc': { label: 'Ad-hoc', color: 'bg-surface-100 text-surface-600', icon: 'schedule' }
        };

        const STATUS_CONFIG = {
            pending: { label: 'Not Started', color: 'bg-surface-100 text-surface-600', icon: 'radio_button_unchecked' },
            'in-progress': { label: 'In Progress', color: 'bg-brand-100 text-brand-600', icon: 'pending' },
            complete: { label: 'Complete', color: 'bg-expert-100 text-expert-600', icon: 'check_circle' }
        };

        // Load topics on page load
        document.addEventListener('DOMContentLoaded', loadTopics);

        async function loadTopics() {
            try {
                const res = await fetch('/topics');
                if (!res.ok) throw new Error('Failed to load topics');
                allTopics = await res.json();
                applyFilters();
                updateStats();
            } catch (error) {
                console.error('Error loading topics:', error);
                document.getElementById('topics-loading').innerHTML = `
                    <span class="material-symbols-outlined text-4xl text-red-400">error</span>
                    <p class="text-sm text-surface-400 mt-2">Failed to load topics</p>
                `;
            }
        }

        function updateStats() {
            const pending = allTopics.filter(t => t.status === 'pending').length;
            const inProgress = allTopics.filter(t => t.status === 'in-progress').length;
            const complete = allTopics.filter(t => t.status === 'complete').length;

            document.getElementById('stat-total').textContent = allTopics.length;
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-inprogress').textContent = inProgress;
            document.getElementById('stat-complete').textContent = complete;
        }

        function applyFilters() {
            const statusFilter = document.getElementById('filter-status').value;
            const frequencyFilter = document.getElementById('filter-frequency').value;
            const groupBy = document.getElementById('group-by').value;

            // Apply filters
            filteredTopics = allTopics.filter(topic => {
                if (statusFilter && topic.status !== statusFilter) return false;
                if (frequencyFilter && topic.frequency !== frequencyFilter) return false;
                return true;
            });

            // Render
            renderTopics(filteredTopics, groupBy);
        }

        function renderTopics(topics, groupBy) {
            const container = document.getElementById('topics-list');
            const loading = document.getElementById('topics-loading');
            const empty = document.getElementById('topics-empty');

            loading.classList.add('hidden');

            if (topics.length === 0) {
                container.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            container.classList.remove('hidden');

            if (groupBy === 'none') {
                container.innerHTML = `
                    <div class="grid gap-4">
                        ${topics.map(topic => renderTopicCard(topic)).join('')}
                    </div>
                `;
            } else {
                // Group topics
                const groups = {};
                for (const topic of topics) {
                    let key;
                    if (groupBy === 'frequency') {
                        key = topic.frequency || 'ad-hoc';
                    } else if (groupBy === 'status') {
                        key = topic.status || 'pending';
                    } else if (groupBy === 'category') {
                        key = topic.category || 'Uncategorized';
                    }
                    if (!groups[key]) groups[key] = [];
                    groups[key].push(topic);
                }

                // Sort group keys
                let sortedKeys = Object.keys(groups);
                if (groupBy === 'frequency') {
                    const order = ['daily', 'weekly', 'monthly', 'quarterly', 'annual', 'ad-hoc'];
                    sortedKeys.sort((a, b) => order.indexOf(a) - order.indexOf(b));
                } else if (groupBy === 'status') {
                    const order = ['pending', 'in-progress', 'complete'];
                    sortedKeys.sort((a, b) => order.indexOf(a) - order.indexOf(b));
                } else {
                    sortedKeys.sort();
                }

                container.innerHTML = sortedKeys.map(key => {
                    const config = groupBy === 'frequency' ? FREQUENCY_CONFIG[key] :
                                   groupBy === 'status' ? STATUS_CONFIG[key] :
                                   { label: key, color: 'bg-surface-100 text-surface-600', icon: 'folder' };

                    return `
                        <div class="mb-8">
                            <div class="flex items-center gap-2 mb-4">
                                <span class="material-symbols-outlined text-[18px] ${config.color.split(' ')[1]}">${config.icon}</span>
                                <h3 class="font-semibold text-surface-700">${config.label}</h3>
                                <span class="text-xs text-surface-400">(${groups[key].length})</span>
                            </div>
                            <div class="grid gap-4">
                                ${groups[key].map(topic => renderTopicCard(topic)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function renderTopicCard(topic) {
            const freq = FREQUENCY_CONFIG[topic.frequency] || FREQUENCY_CONFIG['ad-hoc'];
            const status = STATUS_CONFIG[topic.status] || STATUS_CONFIG.pending;

            return `
                <div class="bg-surface-0 rounded-xl border border-surface-200/60 shadow-card hover:shadow-lg transition-all p-5 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="font-semibold text-surface-800 truncate">${topic.name}</h3>
                                <span class="px-2 py-0.5 rounded-full text-[10px] font-bold uppercase ${freq.color}">${freq.label}</span>
                                <span class="px-2 py-0.5 rounded-full text-[10px] font-bold uppercase ${status.color}">${status.label}</span>
                            </div>
                            ${topic.description ? `<p class="text-sm text-surface-500 line-clamp-2 mb-3">${topic.description}</p>` : ''}
                            ${topic.category ? `
                                <div class="flex items-center gap-1 text-xs text-surface-400">
                                    <span class="material-symbols-outlined text-[14px]">folder</span>
                                    ${topic.category}
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            ${topic.status === 'pending' ? `
                                <button onclick="startInterview('${topic.id}')" class="flex items-center gap-1 px-3 py-1.5 rounded-lg bg-expert-500 hover:bg-expert-600 text-white text-xs font-semibold transition-colors">
                                    <span class="material-symbols-outlined text-[16px]">play_arrow</span>
                                    Start
                                </button>
                            ` : topic.status === 'in-progress' ? `
                                <button onclick="continueInterview('${topic.id}')" class="flex items-center gap-1 px-3 py-1.5 rounded-lg bg-brand-500 hover:bg-brand-600 text-white text-xs font-semibold transition-colors">
                                    <span class="material-symbols-outlined text-[16px]">play_arrow</span>
                                    Continue
                                </button>
                            ` : `
                                <button onclick="viewKnowledge('${topic.id}')" class="flex items-center gap-1 px-3 py-1.5 rounded-lg bg-surface-100 hover:bg-surface-200 text-surface-600 text-xs font-semibold transition-colors">
                                    <span class="material-symbols-outlined text-[16px]">visibility</span>
                                    View
                                </button>
                            `}
                            <button onclick="editTopic('${topic.id}')" class="p-1.5 rounded-lg hover:bg-surface-100 text-surface-400 hover:text-surface-600 transition-colors">
                                <span class="material-symbols-outlined text-[18px]">edit</span>
                            </button>
                            <button onclick="deleteTopic('${topic.id}')" class="p-1.5 rounded-lg hover:bg-red-50 text-surface-400 hover:text-red-500 transition-colors">
                                <span class="material-symbols-outlined text-[18px]">delete</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Modal functions
        function openAddTopicModal() {
            document.getElementById('modal-title').textContent = 'Add Topic';
            document.getElementById('modal-subtitle').textContent = 'Define a new knowledge area';
            document.getElementById('modal-icon').textContent = 'add_circle';
            document.getElementById('topic-id').value = '';
            document.getElementById('topic-form').reset();
            document.getElementById('topic-modal').classList.remove('hidden');
        }

        function editTopic(topicId) {
            const topic = allTopics.find(t => t.id === topicId);
            if (!topic) return;

            document.getElementById('modal-title').textContent = 'Edit Topic';
            document.getElementById('modal-subtitle').textContent = 'Update topic details';
            document.getElementById('modal-icon').textContent = 'edit';
            document.getElementById('topic-id').value = topic.id;
            document.getElementById('topic-name').value = topic.name;
            document.getElementById('topic-description').value = topic.description || '';
            document.getElementById('topic-frequency').value = topic.frequency || 'ad-hoc';
            document.getElementById('topic-category').value = topic.category || '';
            document.getElementById('topic-modal').classList.remove('hidden');
        }

        function closeTopicModal() {
            document.getElementById('topic-modal').classList.add('hidden');
        }

        async function saveTopic(event) {
            event.preventDefault();

            const topicId = document.getElementById('topic-id').value;
            const name = document.getElementById('topic-name').value.trim();
            const description = document.getElementById('topic-description').value.trim();
            const frequency = document.getElementById('topic-frequency').value;
            const category = document.getElementById('topic-category').value.trim();

            if (!name) {
                alert('Topic name is required');
                return;
            }

            const data = { name, description, frequency, category };

            try {
                let res;
                if (topicId) {
                    res = await fetch(`/topics/${topicId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } else {
                    res = await fetch('/topics', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                }

                if (!res.ok) throw new Error('Failed to save topic');

                closeTopicModal();
                loadTopics();
            } catch (error) {
                console.error('Error saving topic:', error);
                alert('Failed to save topic. Please try again.');
            }
        }

        async function deleteTopic(topicId) {
            if (!confirm('Are you sure you want to delete this topic?')) return;

            try {
                const res = await fetch(`/topics/${topicId}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('Failed to delete topic');
                loadTopics();
            } catch (error) {
                console.error('Error deleting topic:', error);
                alert('Failed to delete topic. Please try again.');
            }
        }

        // Interview actions
        function startInterview(topicId) {
            // Update topic status to in-progress and navigate to interview
            fetch(`/topics/${topicId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: 'in-progress' })
            }).then(() => {
                window.location.href = `interview.html?topic=${topicId}`;
            });
        }

        function continueInterview(topicId) {
            window.location.href = `interview.html?topic=${topicId}`;
        }

        function viewKnowledge(topicId) {
            window.location.href = `review.html?topic=${topicId}`;
        }
    </script>
</body>
</html>
